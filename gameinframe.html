<html>
    <head>
        <title>Zanimation</title>
        <script src='https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.js'></script>
        <style>

            .ice{
                background-image: url('https://www.carbonbrief.org/wp-content/uploads/2015/04/ice-caves-iceland-dark-ice-1550x804.jpg');
                width:250px;
                height:400px;
                position: absolute;
                top: 245px;
                left: 500px;
                z-index: 2
            }
            .man{

                background-image: url('https://orig00.deviantart.net/edeb/f/2013/309/1/1/he_man_running_by_bwwd-d6t6090.gif');
                height:222px;
                width:220px;
                position:absolute;
                top:423px;  
                z-index: 3; 
            }
            .panel{
                background-image: url('https://images.alphacoders.com/152/152113.jpg');
                height:645px;
                width: 20000px;
                top: 0px;
                position: relative;
                z-index: 1;
                
            }
            .added{
                left: 1200px;
                z-index: 2;
            }

        </style>
    </head>
    <body>

        <p style="color: gold"></p>
        <div class="panel">
            <div class="ice"></div>
            <div class='man'></div>
        </div>
        <script>
            $(function(){

                var oldtime =  0;
                var newtime = 0;
                var reference = 0;
              $(document).on('keydown',function(event){

                
                var posMan = $('.man').position();  
                var posIce = $('.ice').position();
                var man = $('.man');
                var ice = $('.ice');

                newtime = event.timeStamp;
                var diff = newtime - oldtime;

                var current = posMan.left;
                
                //alert(diff);
                
                //$('.man').animate({left: '+=0px'});
                if(event.which==39&&diff>=100)
                {

                    if((posMan.left+200<posIce.left)||(posMan.left>posIce.left+100)) 
                    {

                        $(".man").animate({left: '+=50px'},100);    //duration    
                    }
                    else if(posMan.top==23)
                    {
                        $(".man").animate({left: '+=50px'},100);
                    }

                    if((posMan.left>posIce.left+150)&&(posMan.top==23))
                    {
                        $('.man').animate({top: '+=400px'},100);
                    }

                    oldtime = newtime;      //updation
                }
                if(event.which==38 && posMan.top==423 && diff>=200)
                {   
                    $('.man').animate({top: '-=400px'}),200;

                    if((posMan.left+200<posIce.left)||(posMan.left>posIce.left+150))
                    {
                        $('.man').animate({top: '+=400px'},200);    
                    }
                    
                    oldtime = newtime;
                }
                
                /* DOWN FUNCTION
                if(event.which==40 && posMan.top==23)
                {

                    
                    if(posMan.left+100>posIce.left+250)
                    {
                        $('.man').animate({top: '+=400px'});
                    }
                }
                */
                $('p').append(':'+current);
                var gap = current - reference
                if(gap>500)             //randomize instead of constant 500
                {
                    $('.panel').append('<div class="ice added"></div>');
                    reference = current;
                }
                
                
              })



            
            
            
            })
        </script>




    </body>
</html>